"use strict";/*
 * Copyright The OpenTelemetry Authors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cov_100qhtr9ee(){var path="/Users/zocong/Documents/forked/aws-opentelemetry-js/packages/opentelemetry-propagator-aws-xray/src/AWSXRayPropagator.ts";var hash="0ef2b243e9e1be75ee8f9b3e6bbc125275380067";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/zocong/Documents/forked/aws-opentelemetry-js/packages/opentelemetry-propagator-aws-xray/src/AWSXRayPropagator.ts",statementMap:{"0":{start:{line:17,column:0},end:{line:17,column:62}},"1":{start:{line:18,column:0},end:{line:18,column:69}},"2":{start:{line:19,column:14},end:{line:19,column:43}},"3":{start:{line:20,column:15},end:{line:20,column:45}},"4":{start:{line:21,column:0},end:{line:21,column:52}},"5":{start:{line:22,column:31},end:{line:22,column:34}},"6":{start:{line:23,column:21},end:{line:23,column:24}},"7":{start:{line:24,column:21},end:{line:24,column:27}},"8":{start:{line:25,column:24},end:{line:25,column:26}},"9":{start:{line:26,column:25},end:{line:26,column:28}},"10":{start:{line:27,column:27},end:{line:27,column:30}},"11":{start:{line:28,column:35},end:{line:28,column:36}},"12":{start:{line:29,column:35},end:{line:29,column:37}},"13":{start:{line:30,column:35},end:{line:30,column:36}},"14":{start:{line:31,column:22},end:{line:31,column:30}},"15":{start:{line:32,column:25},end:{line:32,column:34}},"16":{start:{line:33,column:28},end:{line:33,column:29}},"17":{start:{line:34,column:19},end:{line:34,column:22}},"18":{start:{line:35,column:20},end:{line:35,column:23}},"19":{start:{line:36,column:28},end:{line:36,column:47}},"20":{start:{line:37,column:27},end:{line:37,column:44}},"21":{start:{line:48,column:28},end:{line:48,column:64}},"22":{start:{line:49,column:8},end:{line:50,column:19}},"23":{start:{line:50,column:12},end:{line:50,column:19}},"24":{start:{line:51,column:26},end:{line:51,column:45}},"25":{start:{line:52,column:28},end:{line:56,column:59}},"26":{start:{line:57,column:25},end:{line:57,column:43}},"27":{start:{line:58,column:29},end:{line:58,column:78}},"28":{start:{line:60,column:28},end:{line:70,column:24}},"29":{start:{line:71,column:8},end:{line:71,column:70}},"30":{start:{line:74,column:28},end:{line:74,column:74}},"31":{start:{line:75,column:8},end:{line:76,column:27}},"32":{start:{line:76,column:12},end:{line:76,column:27}},"33":{start:{line:77,column:8},end:{line:77,column:68}},"34":{start:{line:80,column:28},end:{line:80,column:76}},"35":{start:{line:82,column:8},end:{line:83,column:47}},"36":{start:{line:83,column:12},end:{line:83,column:47}},"37":{start:{line:84,column:18},end:{line:84,column:19}},"38":{start:{line:86,column:28},end:{line:86,column:50}},"39":{start:{line:87,column:27},end:{line:87,column:48}},"40":{start:{line:88,column:31},end:{line:88,column:35}},"41":{start:{line:89,column:8},end:{line:111,column:9}},"42":{start:{line:90,column:35},end:{line:90,column:83}},"43":{start:{line:91,column:12},end:{line:99,column:13}},"44":{start:{line:92,column:16},end:{line:92,column:80}},"45":{start:{line:93,column:16},end:{line:93,column:41}},"46":{start:{line:97,column:16},end:{line:97,column:64}},"47":{start:{line:98,column:16},end:{line:98,column:41}},"48":{start:{line:100,column:32},end:{line:100,column:65}},"49":{start:{line:101,column:26},end:{line:101,column:64}},"50":{start:{line:102,column:12},end:{line:104,column:13}},"51":{start:{line:103,column:16},end:{line:103,column:58}},"52":{start:{line:105,column:12},end:{line:107,column:13}},"53":{start:{line:106,column:16},end:{line:106,column:56}},"54":{start:{line:108,column:12},end:{line:110,column:13}},"55":{start:{line:109,column:16},end:{line:109,column:63}},"56":{start:{line:112,column:8},end:{line:114,column:9}},"57":{start:{line:113,column:12},end:{line:113,column:47}},"58":{start:{line:115,column:34},end:{line:120,column:9}},"59":{start:{line:121,column:8},end:{line:123,column:9}},"60":{start:{line:122,column:12},end:{line:122,column:47}},"61":{start:{line:124,column:8},end:{line:124,column:33}},"62":{start:{line:128,column:8},end:{line:130,column:9}},"63":{start:{line:129,column:12},end:{line:129,column:42}},"64":{start:{line:132,column:8},end:{line:134,column:9}},"65":{start:{line:133,column:12},end:{line:133,column:42}},"66":{start:{line:136,column:8},end:{line:139,column:9}},"67":{start:{line:138,column:12},end:{line:138,column:42}},"68":{start:{line:140,column:26},end:{line:140,column:107}},"69":{start:{line:141,column:27},end:{line:141,column:97}},"70":{start:{line:142,column:27},end:{line:142,column:49}},"71":{start:{line:144,column:8},end:{line:146,column:9}},"72":{start:{line:145,column:12},end:{line:145,column:42}},"73":{start:{line:147,column:8},end:{line:147,column:26}},"74":{start:{line:150,column:8},end:{line:152,column:36}},"75":{start:{line:155,column:8},end:{line:158,column:9}},"76":{start:{line:157,column:12},end:{line:157,column:41}},"77":{start:{line:159,column:8},end:{line:161,column:9}},"78":{start:{line:160,column:12},end:{line:160,column:44}},"79":{start:{line:162,column:8},end:{line:162,column:20}},"80":{start:{line:165,column:0},end:{line:165,column:46}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:47,column:4},end:{line:47,column:5}},loc:{start:{line:47,column:37},end:{line:72,column:5}},line:47},"1":{name:"(anonymous_1)",decl:{start:{line:73,column:4},end:{line:73,column:5}},loc:{start:{line:73,column:38},end:{line:78,column:5}},line:73},"2":{name:"(anonymous_2)",decl:{start:{line:79,column:4},end:{line:79,column:5}},loc:{start:{line:79,column:46},end:{line:125,column:5}},line:79},"3":{name:"(anonymous_3)",decl:{start:{line:126,column:4},end:{line:126,column:5}},loc:{start:{line:126,column:31},end:{line:148,column:5}},line:126},"4":{name:"(anonymous_4)",decl:{start:{line:149,column:4},end:{line:149,column:5}},loc:{start:{line:149,column:31},end:{line:153,column:5}},line:149},"5":{name:"(anonymous_5)",decl:{start:{line:154,column:4},end:{line:154,column:5}},loc:{start:{line:154,column:37},end:{line:163,column:5}},line:154}},branchMap:{"0":{loc:{start:{line:49,column:8},end:{line:50,column:19}},type:"if",locations:[{start:{line:49,column:8},end:{line:50,column:19}},{start:{line:49,column:8},end:{line:50,column:19}}],line:49},"1":{loc:{start:{line:49,column:12},end:{line:49,column:56}},type:"binary-expr",locations:[{start:{line:49,column:12},end:{line:49,column:24}},{start:{line:49,column:28},end:{line:49,column:56}}],line:49},"2":{loc:{start:{line:58,column:29},end:{line:58,column:78}},type:"cond-expr",locations:[{start:{line:58,column:54},end:{line:58,column:64}},{start:{line:58,column:67},end:{line:58,column:78}}],line:58},"3":{loc:{start:{line:75,column:8},end:{line:76,column:27}},type:"if",locations:[{start:{line:75,column:8},end:{line:76,column:27}},{start:{line:75,column:8},end:{line:76,column:27}}],line:75},"4":{loc:{start:{line:82,column:8},end:{line:83,column:47}},type:"if",locations:[{start:{line:82,column:8},end:{line:83,column:47}},{start:{line:82,column:8},end:{line:83,column:47}}],line:82},"5":{loc:{start:{line:82,column:12},end:{line:82,column:59}},type:"binary-expr",locations:[{start:{line:82,column:12},end:{line:82,column:24}},{start:{line:82,column:28},end:{line:82,column:59}}],line:82},"6":{loc:{start:{line:91,column:12},end:{line:99,column:13}},type:"if",locations:[{start:{line:91,column:12},end:{line:99,column:13}},{start:{line:91,column:12},end:{line:99,column:13}}],line:91},"7":{loc:{start:{line:102,column:12},end:{line:104,column:13}},type:"if",locations:[{start:{line:102,column:12},end:{line:104,column:13}},{start:{line:102,column:12},end:{line:104,column:13}}],line:102},"8":{loc:{start:{line:105,column:12},end:{line:107,column:13}},type:"if",locations:[{start:{line:105,column:12},end:{line:107,column:13}},{start:{line:105,column:12},end:{line:107,column:13}}],line:105},"9":{loc:{start:{line:108,column:12},end:{line:110,column:13}},type:"if",locations:[{start:{line:108,column:12},end:{line:110,column:13}},{start:{line:108,column:12},end:{line:110,column:13}}],line:108},"10":{loc:{start:{line:112,column:8},end:{line:114,column:9}},type:"if",locations:[{start:{line:112,column:8},end:{line:114,column:9}},{start:{line:112,column:8},end:{line:114,column:9}}],line:112},"11":{loc:{start:{line:121,column:8},end:{line:123,column:9}},type:"if",locations:[{start:{line:121,column:8},end:{line:123,column:9}},{start:{line:121,column:8},end:{line:123,column:9}}],line:121},"12":{loc:{start:{line:128,column:8},end:{line:130,column:9}},type:"if",locations:[{start:{line:128,column:8},end:{line:130,column:9}},{start:{line:128,column:8},end:{line:130,column:9}}],line:128},"13":{loc:{start:{line:132,column:8},end:{line:134,column:9}},type:"if",locations:[{start:{line:132,column:8},end:{line:134,column:9}},{start:{line:132,column:8},end:{line:134,column:9}}],line:132},"14":{loc:{start:{line:136,column:8},end:{line:139,column:9}},type:"if",locations:[{start:{line:136,column:8},end:{line:139,column:9}},{start:{line:136,column:8},end:{line:139,column:9}}],line:136},"15":{loc:{start:{line:136,column:12},end:{line:137,column:81}},type:"binary-expr",locations:[{start:{line:136,column:12},end:{line:136,column:81}},{start:{line:137,column:12},end:{line:137,column:81}}],line:136},"16":{loc:{start:{line:144,column:8},end:{line:146,column:9}},type:"if",locations:[{start:{line:144,column:8},end:{line:146,column:9}},{start:{line:144,column:8},end:{line:146,column:9}}],line:144},"17":{loc:{start:{line:150,column:15},end:{line:152,column:35}},type:"cond-expr",locations:[{start:{line:151,column:14},end:{line:151,column:26}},{start:{line:152,column:14},end:{line:152,column:35}}],line:150},"18":{loc:{start:{line:155,column:8},end:{line:158,column:9}},type:"if",locations:[{start:{line:155,column:8},end:{line:158,column:9}},{start:{line:155,column:8},end:{line:158,column:9}}],line:155},"19":{loc:{start:{line:155,column:12},end:{line:156,column:43}},type:"binary-expr",locations:[{start:{line:155,column:12},end:{line:155,column:58}},{start:{line:156,column:12},end:{line:156,column:43}}],line:155},"20":{loc:{start:{line:159,column:8},end:{line:161,column:9}},type:"if",locations:[{start:{line:159,column:8},end:{line:161,column:9}},{start:{line:159,column:8},end:{line:161,column:9}}],line:159}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0,"74":0,"75":0,"76":0,"77":0,"78":0,"79":0,"80":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0],"19":[0,0],"20":[0,0]},inputSourceMap:{version:3,file:"/Users/zocong/Documents/forked/aws-opentelemetry-js/packages/opentelemetry-propagator-aws-xray/src/AWSXRayPropagator.ts",sources:["/Users/zocong/Documents/forked/aws-opentelemetry-js/packages/opentelemetry-propagator-aws-xray/src/AWSXRayPropagator.ts"],names:[],mappings:"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",sourcesContent:["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  Context,\n  HttpTextPropagator,\n  SpanContext,\n  TraceFlags,\n  SetterFunction,\n  GetterFunction,\n  INVALID_TRACE_ID,\n  INVALID_SPAN_ID,\n} from '@opentelemetry/api';\nimport {\n  getParentSpanContext,\n  setExtractedSpanContext,\n  INVALID_SPAN_CONTEXT,\n  isValid,\n} from '@opentelemetry/core';\n\nexport const AWSXRAY_TRACE_ID_HEADER = 'X-Amzn-Trace-Id';\n\nconst TRACE_HEADER_DELIMITER = ';';\nconst KV_DELIMITER = '=';\n\nconst TRACE_ID_KEY = 'Root';\nconst TRACE_ID_LENGTH = 35;\nconst TRACE_ID_VERSION = '1';\nconst TRACE_ID_DELIMITER = '-';\nconst TRACE_ID_DELIMITER_INDEX_1 = 1;\nconst TRACE_ID_DELIMITER_INDEX_2 = 10;\nconst TRACE_ID_FIRST_PART_LENGTH = 8;\n\nconst PARENT_ID_KEY = 'Parent';\n\nconst SAMPLED_FLAG_KEY = 'Sampled';\nconst SAMPLED_FLAG_LENGTH = 1;\nconst IS_SAMPLED = '1';\nconst NOT_SAMPLED = '0';\n\nconst VALID_TRACEID_REGEX = /^([0-9a-f]{32})$/i;\nconst VALID_SPANID_REGEX = /^[0-9a-f]{16}$/i;\n/**\n * Implementation of the AWS X-Ray Trace Header propagation protocol. See <a href=\n * https://https://docs.aws.amazon.com/xray/latest/devguide/xray-concepts.html#xray-concepts-tracingheader>AWS\n * Tracing header spec</a>\n *\n * An example AWS Xray Tracing Header is shown below:\n * X-Amzn-Trace-Id: Root=1-5759e988-bd862e3fe1be46a994272793;Parent=53995c3f42cd8ad8;Sampled=1\n */\nexport class AWSXRayPropagator implements HttpTextPropagator {\n  inject(context: Context, carrier: unknown, setter: SetterFunction) {\n    const spanContext = getParentSpanContext(context);\n    if (!spanContext || !isValid(spanContext)) return;\n\n    const otTraceId = spanContext.traceId;\n    const xrayTraceId =\n      TRACE_ID_VERSION +\n      TRACE_ID_DELIMITER +\n      otTraceId.substring(0, TRACE_ID_FIRST_PART_LENGTH) +\n      TRACE_ID_DELIMITER +\n      otTraceId.substring(TRACE_ID_FIRST_PART_LENGTH);\n    const parentId = spanContext.spanId;\n    const samplingFlag = spanContext.traceFlags ? IS_SAMPLED : NOT_SAMPLED;\n    // TODO: Add OT trace state to the X-Ray trace header\n\n    const traceHeader =\n      TRACE_ID_KEY +\n      KV_DELIMITER +\n      xrayTraceId +\n      TRACE_HEADER_DELIMITER +\n      PARENT_ID_KEY +\n      KV_DELIMITER +\n      parentId +\n      TRACE_HEADER_DELIMITER +\n      SAMPLED_FLAG_KEY +\n      KV_DELIMITER +\n      samplingFlag;\n\n    setter(carrier, AWSXRAY_TRACE_ID_HEADER, traceHeader);\n  }\n\n  extract(context: Context, carrier: unknown, getter: GetterFunction): Context {\n    const spanContext = this.getSpanContextFromHeader(carrier, getter);\n    if (!isValid(spanContext)) return context;\n\n    return setExtractedSpanContext(context, spanContext);\n  }\n\n  private getSpanContextFromHeader(\n    carrier: unknown,\n    getter: GetterFunction\n  ): SpanContext {\n    const traceHeader = getter(carrier, AWSXRAY_TRACE_ID_HEADER);\n    // Only if the returned traceHeader is no empty string can be extracted\n    if (!traceHeader || typeof traceHeader !== 'string')\n      return INVALID_SPAN_CONTEXT;\n\n    let pos = 0;\n    let trimmedPart: string;\n    let parsedTraceId = INVALID_TRACE_ID;\n    let parsedSpanId = INVALID_SPAN_ID;\n    let parsedTraceFlags = null;\n    while (pos < traceHeader.length) {\n      const delimiterIndex = traceHeader.indexOf(TRACE_HEADER_DELIMITER, pos);\n      if (delimiterIndex >= 0) {\n        trimmedPart = traceHeader.substring(pos, delimiterIndex).trim();\n        pos = delimiterIndex + 1;\n      } else {\n        //last part\n        trimmedPart = traceHeader.substring(pos).trim();\n        pos = traceHeader.length;\n      }\n      const equalsIndex = trimmedPart.indexOf(KV_DELIMITER);\n\n      const value = trimmedPart.substring(equalsIndex + 1);\n\n      if (trimmedPart.startsWith(TRACE_ID_KEY)) {\n        parsedTraceId = this._parseTraceId(value);\n      }\n      if (trimmedPart.startsWith(PARENT_ID_KEY)) {\n        parsedSpanId = this._parseSpanId(value);\n      }\n      if (trimmedPart.startsWith(SAMPLED_FLAG_KEY)) {\n        parsedTraceFlags = this._parseTraceFlag(value);\n      }\n    }\n    if (parsedTraceFlags === null) {\n      return INVALID_SPAN_CONTEXT;\n    }\n    const resultSpanContext: SpanContext = {\n      traceId: parsedTraceId,\n      spanId: parsedSpanId,\n      traceFlags: parsedTraceFlags,\n      isRemote: true,\n    };\n    if (!isValid(resultSpanContext)) {\n      return INVALID_SPAN_CONTEXT;\n    }\n    return resultSpanContext;\n  }\n\n  private _parseTraceId(xrayTraceId: string): string {\n    // Check length of trace id\n    if (xrayTraceId.length !== TRACE_ID_LENGTH) {\n      return INVALID_TRACE_ID;\n    }\n\n    // Check version trace id version\n    if (!xrayTraceId.startsWith(TRACE_ID_VERSION)) {\n      return INVALID_TRACE_ID;\n    }\n\n    // Check delimiters\n    if (\n      xrayTraceId.charAt(TRACE_ID_DELIMITER_INDEX_1) !== TRACE_ID_DELIMITER ||\n      xrayTraceId.charAt(TRACE_ID_DELIMITER_INDEX_2) !== TRACE_ID_DELIMITER\n    ) {\n      return INVALID_TRACE_ID;\n    }\n\n    const epochPart = xrayTraceId.substring(\n      TRACE_ID_DELIMITER_INDEX_1 + 1,\n      TRACE_ID_DELIMITER_INDEX_2\n    );\n    const uniquePart = xrayTraceId.substring(\n      TRACE_ID_DELIMITER_INDEX_2 + 1,\n      TRACE_ID_LENGTH\n    );\n    const resTraceId = epochPart + uniquePart;\n\n    // Check the content of trace id\n    if (!VALID_TRACEID_REGEX.test(resTraceId)) {\n      return INVALID_TRACE_ID;\n    }\n\n    return resTraceId;\n  }\n\n  private _parseSpanId(xrayParentId: string): string {\n    return VALID_SPANID_REGEX.test(xrayParentId)\n      ? xrayParentId\n      : INVALID_SPAN_ID;\n  }\n\n  private _parseTraceFlag(xraySampledFlag: string): TraceFlags | null {\n    if (\n      xraySampledFlag.length === SAMPLED_FLAG_LENGTH &&\n      xraySampledFlag === NOT_SAMPLED\n    ) {\n      return TraceFlags.NONE;\n    }\n    if (xraySampledFlag === IS_SAMPLED) {\n      return TraceFlags.SAMPLED;\n    }\n    return null;\n  }\n}\n"]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"0ef2b243e9e1be75ee8f9b3e6bbc125275380067"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_100qhtr9ee=function(){return actualCoverage;};}return actualCoverage;}cov_100qhtr9ee();cov_100qhtr9ee().s[0]++;Object.defineProperty(exports,"__esModule",{value:true});cov_100qhtr9ee().s[1]++;exports.AWSXRayPropagator=exports.AWSXRAY_TRACE_ID_HEADER=void 0;const api_1=(cov_100qhtr9ee().s[2]++,require("@opentelemetry/api"));const core_1=(cov_100qhtr9ee().s[3]++,require("@opentelemetry/core"));cov_100qhtr9ee().s[4]++;exports.AWSXRAY_TRACE_ID_HEADER='X-Amzn-Trace-Id';const TRACE_HEADER_DELIMITER=(cov_100qhtr9ee().s[5]++,';');const KV_DELIMITER=(cov_100qhtr9ee().s[6]++,'=');const TRACE_ID_KEY=(cov_100qhtr9ee().s[7]++,'Root');const TRACE_ID_LENGTH=(cov_100qhtr9ee().s[8]++,35);const TRACE_ID_VERSION=(cov_100qhtr9ee().s[9]++,'1');const TRACE_ID_DELIMITER=(cov_100qhtr9ee().s[10]++,'-');const TRACE_ID_DELIMITER_INDEX_1=(cov_100qhtr9ee().s[11]++,1);const TRACE_ID_DELIMITER_INDEX_2=(cov_100qhtr9ee().s[12]++,10);const TRACE_ID_FIRST_PART_LENGTH=(cov_100qhtr9ee().s[13]++,8);const PARENT_ID_KEY=(cov_100qhtr9ee().s[14]++,'Parent');const SAMPLED_FLAG_KEY=(cov_100qhtr9ee().s[15]++,'Sampled');const SAMPLED_FLAG_LENGTH=(cov_100qhtr9ee().s[16]++,1);const IS_SAMPLED=(cov_100qhtr9ee().s[17]++,'1');const NOT_SAMPLED=(cov_100qhtr9ee().s[18]++,'0');const VALID_TRACEID_REGEX=(cov_100qhtr9ee().s[19]++,/^([0-9a-f]{32})$/i);const VALID_SPANID_REGEX=(cov_100qhtr9ee().s[20]++,/^[0-9a-f]{16}$/i);/**
 * Implementation of the AWS X-Ray Trace Header propagation protocol. See <a href=
 * https://https://docs.aws.amazon.com/xray/latest/devguide/xray-concepts.html#xray-concepts-tracingheader>AWS
 * Tracing header spec</a>
 *
 * An example AWS Xray Tracing Header is shown below:
 * X-Amzn-Trace-Id: Root=1-5759e988-bd862e3fe1be46a994272793;Parent=53995c3f42cd8ad8;Sampled=1
 */class AWSXRayPropagator{inject(context,carrier,setter){cov_100qhtr9ee().f[0]++;const spanContext=(cov_100qhtr9ee().s[21]++,core_1.getParentSpanContext(context));cov_100qhtr9ee().s[22]++;if((cov_100qhtr9ee().b[1][0]++,!spanContext)||(cov_100qhtr9ee().b[1][1]++,!core_1.isValid(spanContext))){cov_100qhtr9ee().b[0][0]++;cov_100qhtr9ee().s[23]++;return;}else{cov_100qhtr9ee().b[0][1]++;}const otTraceId=(cov_100qhtr9ee().s[24]++,spanContext.traceId);const xrayTraceId=(cov_100qhtr9ee().s[25]++,TRACE_ID_VERSION+TRACE_ID_DELIMITER+otTraceId.substring(0,TRACE_ID_FIRST_PART_LENGTH)+TRACE_ID_DELIMITER+otTraceId.substring(TRACE_ID_FIRST_PART_LENGTH));const parentId=(cov_100qhtr9ee().s[26]++,spanContext.spanId);const samplingFlag=(cov_100qhtr9ee().s[27]++,spanContext.traceFlags?(cov_100qhtr9ee().b[2][0]++,IS_SAMPLED):(cov_100qhtr9ee().b[2][1]++,NOT_SAMPLED));// TODO: Add OT trace state to the X-Ray trace header
const traceHeader=(cov_100qhtr9ee().s[28]++,TRACE_ID_KEY+KV_DELIMITER+xrayTraceId+TRACE_HEADER_DELIMITER+PARENT_ID_KEY+KV_DELIMITER+parentId+TRACE_HEADER_DELIMITER+SAMPLED_FLAG_KEY+KV_DELIMITER+samplingFlag);cov_100qhtr9ee().s[29]++;setter(carrier,exports.AWSXRAY_TRACE_ID_HEADER,traceHeader);}extract(context,carrier,getter){cov_100qhtr9ee().f[1]++;const spanContext=(cov_100qhtr9ee().s[30]++,this.getSpanContextFromHeader(carrier,getter));cov_100qhtr9ee().s[31]++;if(!core_1.isValid(spanContext)){cov_100qhtr9ee().b[3][0]++;cov_100qhtr9ee().s[32]++;return context;}else{cov_100qhtr9ee().b[3][1]++;}cov_100qhtr9ee().s[33]++;return core_1.setExtractedSpanContext(context,spanContext);}getSpanContextFromHeader(carrier,getter){cov_100qhtr9ee().f[2]++;const traceHeader=(cov_100qhtr9ee().s[34]++,getter(carrier,exports.AWSXRAY_TRACE_ID_HEADER));// Only if the returned traceHeader is no empty string can be extracted
cov_100qhtr9ee().s[35]++;if((cov_100qhtr9ee().b[5][0]++,!traceHeader)||(cov_100qhtr9ee().b[5][1]++,typeof traceHeader!=='string')){cov_100qhtr9ee().b[4][0]++;cov_100qhtr9ee().s[36]++;return core_1.INVALID_SPAN_CONTEXT;}else{cov_100qhtr9ee().b[4][1]++;}let pos=(cov_100qhtr9ee().s[37]++,0);let trimmedPart;let parsedTraceId=(cov_100qhtr9ee().s[38]++,api_1.INVALID_TRACE_ID);let parsedSpanId=(cov_100qhtr9ee().s[39]++,api_1.INVALID_SPAN_ID);let parsedTraceFlags=(cov_100qhtr9ee().s[40]++,null);cov_100qhtr9ee().s[41]++;while(pos<traceHeader.length){const delimiterIndex=(cov_100qhtr9ee().s[42]++,traceHeader.indexOf(TRACE_HEADER_DELIMITER,pos));cov_100qhtr9ee().s[43]++;if(delimiterIndex>=0){cov_100qhtr9ee().b[6][0]++;cov_100qhtr9ee().s[44]++;trimmedPart=traceHeader.substring(pos,delimiterIndex).trim();cov_100qhtr9ee().s[45]++;pos=delimiterIndex+1;}else{cov_100qhtr9ee().b[6][1]++;cov_100qhtr9ee().s[46]++;//last part
trimmedPart=traceHeader.substring(pos).trim();cov_100qhtr9ee().s[47]++;pos=traceHeader.length;}const equalsIndex=(cov_100qhtr9ee().s[48]++,trimmedPart.indexOf(KV_DELIMITER));const value=(cov_100qhtr9ee().s[49]++,trimmedPart.substring(equalsIndex+1));cov_100qhtr9ee().s[50]++;if(trimmedPart.startsWith(TRACE_ID_KEY)){cov_100qhtr9ee().b[7][0]++;cov_100qhtr9ee().s[51]++;parsedTraceId=this._parseTraceId(value);}else{cov_100qhtr9ee().b[7][1]++;}cov_100qhtr9ee().s[52]++;if(trimmedPart.startsWith(PARENT_ID_KEY)){cov_100qhtr9ee().b[8][0]++;cov_100qhtr9ee().s[53]++;parsedSpanId=this._parseSpanId(value);}else{cov_100qhtr9ee().b[8][1]++;}cov_100qhtr9ee().s[54]++;if(trimmedPart.startsWith(SAMPLED_FLAG_KEY)){cov_100qhtr9ee().b[9][0]++;cov_100qhtr9ee().s[55]++;parsedTraceFlags=this._parseTraceFlag(value);}else{cov_100qhtr9ee().b[9][1]++;}}cov_100qhtr9ee().s[56]++;if(parsedTraceFlags===null){cov_100qhtr9ee().b[10][0]++;cov_100qhtr9ee().s[57]++;return core_1.INVALID_SPAN_CONTEXT;}else{cov_100qhtr9ee().b[10][1]++;}const resultSpanContext=(cov_100qhtr9ee().s[58]++,{traceId:parsedTraceId,spanId:parsedSpanId,traceFlags:parsedTraceFlags,isRemote:true});cov_100qhtr9ee().s[59]++;if(!core_1.isValid(resultSpanContext)){cov_100qhtr9ee().b[11][0]++;cov_100qhtr9ee().s[60]++;return core_1.INVALID_SPAN_CONTEXT;}else{cov_100qhtr9ee().b[11][1]++;}cov_100qhtr9ee().s[61]++;return resultSpanContext;}_parseTraceId(xrayTraceId){cov_100qhtr9ee().f[3]++;cov_100qhtr9ee().s[62]++;// Check length of trace id
if(xrayTraceId.length!==TRACE_ID_LENGTH){cov_100qhtr9ee().b[12][0]++;cov_100qhtr9ee().s[63]++;return api_1.INVALID_TRACE_ID;}else{cov_100qhtr9ee().b[12][1]++;}// Check version trace id version
cov_100qhtr9ee().s[64]++;if(!xrayTraceId.startsWith(TRACE_ID_VERSION)){cov_100qhtr9ee().b[13][0]++;cov_100qhtr9ee().s[65]++;return api_1.INVALID_TRACE_ID;}else{cov_100qhtr9ee().b[13][1]++;}// Check delimiters
cov_100qhtr9ee().s[66]++;if((cov_100qhtr9ee().b[15][0]++,xrayTraceId.charAt(TRACE_ID_DELIMITER_INDEX_1)!==TRACE_ID_DELIMITER)||(cov_100qhtr9ee().b[15][1]++,xrayTraceId.charAt(TRACE_ID_DELIMITER_INDEX_2)!==TRACE_ID_DELIMITER)){cov_100qhtr9ee().b[14][0]++;cov_100qhtr9ee().s[67]++;return api_1.INVALID_TRACE_ID;}else{cov_100qhtr9ee().b[14][1]++;}const epochPart=(cov_100qhtr9ee().s[68]++,xrayTraceId.substring(TRACE_ID_DELIMITER_INDEX_1+1,TRACE_ID_DELIMITER_INDEX_2));const uniquePart=(cov_100qhtr9ee().s[69]++,xrayTraceId.substring(TRACE_ID_DELIMITER_INDEX_2+1,TRACE_ID_LENGTH));const resTraceId=(cov_100qhtr9ee().s[70]++,epochPart+uniquePart);// Check the content of trace id
cov_100qhtr9ee().s[71]++;if(!VALID_TRACEID_REGEX.test(resTraceId)){cov_100qhtr9ee().b[16][0]++;cov_100qhtr9ee().s[72]++;return api_1.INVALID_TRACE_ID;}else{cov_100qhtr9ee().b[16][1]++;}cov_100qhtr9ee().s[73]++;return resTraceId;}_parseSpanId(xrayParentId){cov_100qhtr9ee().f[4]++;cov_100qhtr9ee().s[74]++;return VALID_SPANID_REGEX.test(xrayParentId)?(cov_100qhtr9ee().b[17][0]++,xrayParentId):(cov_100qhtr9ee().b[17][1]++,api_1.INVALID_SPAN_ID);}_parseTraceFlag(xraySampledFlag){cov_100qhtr9ee().f[5]++;cov_100qhtr9ee().s[75]++;if((cov_100qhtr9ee().b[19][0]++,xraySampledFlag.length===SAMPLED_FLAG_LENGTH)&&(cov_100qhtr9ee().b[19][1]++,xraySampledFlag===NOT_SAMPLED)){cov_100qhtr9ee().b[18][0]++;cov_100qhtr9ee().s[76]++;return api_1.TraceFlags.NONE;}else{cov_100qhtr9ee().b[18][1]++;}cov_100qhtr9ee().s[77]++;if(xraySampledFlag===IS_SAMPLED){cov_100qhtr9ee().b[20][0]++;cov_100qhtr9ee().s[78]++;return api_1.TraceFlags.SAMPLED;}else{cov_100qhtr9ee().b[20][1]++;}cov_100qhtr9ee().s[79]++;return null;}}cov_100qhtr9ee().s[80]++;exports.AWSXRayPropagator=AWSXRayPropagator;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL1VzZXJzL3pvY29uZy9Eb2N1bWVudHMvZm9ya2VkL2F3cy1vcGVudGVsZW1ldHJ5LWpzL3BhY2thZ2VzL29wZW50ZWxlbWV0cnktcHJvcGFnYXRvci1hd3MteHJheS9zcmMvQVdTWFJheVByb3BhZ2F0b3IudHMiLCJzb3VyY2VzIjpbIi9Vc2Vycy96b2NvbmcvRG9jdW1lbnRzL2ZvcmtlZC9hd3Mtb3BlbnRlbGVtZXRyeS1qcy9wYWNrYWdlcy9vcGVudGVsZW1ldHJ5LXByb3BhZ2F0b3ItYXdzLXhyYXkvc3JjL0FXU1hSYXlQcm9wYWdhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7Ozs7R0FjRzs7O0FBRUgsNENBUzRCO0FBQzVCLDhDQUs2QjtBQUVoQixRQUFBLHVCQUF1QixHQUFHLGlCQUFpQixDQUFDO0FBRXpELE1BQU0sc0JBQXNCLEdBQUcsR0FBRyxDQUFDO0FBQ25DLE1BQU0sWUFBWSxHQUFHLEdBQUcsQ0FBQztBQUV6QixNQUFNLFlBQVksR0FBRyxNQUFNLENBQUM7QUFDNUIsTUFBTSxlQUFlLEdBQUcsRUFBRSxDQUFDO0FBQzNCLE1BQU0sZ0JBQWdCLEdBQUcsR0FBRyxDQUFDO0FBQzdCLE1BQU0sa0JBQWtCLEdBQUcsR0FBRyxDQUFDO0FBQy9CLE1BQU0sMEJBQTBCLEdBQUcsQ0FBQyxDQUFDO0FBQ3JDLE1BQU0sMEJBQTBCLEdBQUcsRUFBRSxDQUFDO0FBQ3RDLE1BQU0sMEJBQTBCLEdBQUcsQ0FBQyxDQUFDO0FBRXJDLE1BQU0sYUFBYSxHQUFHLFFBQVEsQ0FBQztBQUUvQixNQUFNLGdCQUFnQixHQUFHLFNBQVMsQ0FBQztBQUNuQyxNQUFNLG1CQUFtQixHQUFHLENBQUMsQ0FBQztBQUM5QixNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUM7QUFDdkIsTUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDO0FBRXhCLE1BQU0sbUJBQW1CLEdBQUcsbUJBQW1CLENBQUM7QUFDaEQsTUFBTSxrQkFBa0IsR0FBRyxpQkFBaUIs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QUNBLE9BQU8sc0JBQWdCLENBQUM7U0FDekI7UUFFRCxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUNyQywwQkFBMEIsR0FBRyxDQUFDLEVBQzlCLDBCQUEwQixDQUMzQixDQUFDO1FBQ0YsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLFNBQVMsQ0FDdEMsMEJBQTBCLEdBQUcsQ0FBQyxFQUM5QixlQUFlLENBQ2hCLENBQUM7UUFDRixNQUFNLFVBQVUsR0FBRyxTQUFTLEdBQUcsVUFBVSxDQUFDO1FBRTFDLGdDQUFnQztRQUNoQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO1lBQ3pDLE9BQU8sc0JBQWdCLENBQUM7U0FDekI7UUFFRCxPQUFPLFVBQVUsQ0FBQztJQUNwQixDQUFDO0lBRU8sWUFBWSxDQUFDLFlBQW9CO1FBQ3ZDLE9BQU8sa0JBQWtCLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQztZQUMxQyxDQUFDLENBQUMsWUFBWTtZQUNkLENBQUMsQ0FBQyxxQkFBZSxDQUFDO0lBQ3RCLENBQUM7SUFFTyxlQUFlLENBQUMsZUFBdUI7UUFDN0MsSUFDRSxlQUFlLENBQUMsTUFBTSxLQUFLLG1CQUFtQjtZQUM5QyxlQUFlLEtBQUssV0FBVyxFQUMvQjtZQUNBLE9BQU8sZ0JBQVUsQ0FBQyxJQUFJLENBQUM7U0FDeEI7UUFDRCxJQUFJLGVBQWUsS0FBSyxVQUFVLEVBQUU7WUFDbEMsT0FBTyxnQkFBVSxDQUFDLE9BQU8sQ0FBQztTQUMzQjtRQUNELE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztDQUNGO0FBbkpELDhDQW1KQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgVGhlIE9wZW5UZWxlbWV0cnkgQXV0aG9yc1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgIGh0dHBzOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gIENvbnRleHQsXG4gIEh0dHBUZXh0UHJvcGFnYXRvcixcbiAgU3BhbkNvbnRleHQsXG4gIFRyYWNlRmxhZ3MsXG4gIFNldHRlckZ1bmN0aW9uLFxuICBHZXR0ZXJGdW5jdGlvbixcbiAgSU5WQUxJRF9UUkFDRV9JRCxcbiAgSU5WQUxJRF9TUEFOX0lELFxufSBmcm9tICdAb3BlbnRlbGVtZXRyeS9hcGknO1xuaW1wb3J0IHtcbiAgZ2V0UGFyZW50U3BhbkNvbnRleHQsXG4gIHNldEV4dHJhY3RlZFNwYW5Db250ZXh0LFxuICBJTlZBTElEX1NQQU5fQ09OVEVYVCxcbiAgaXNWYWxpZCxcbn0gZnJvbSAnQG9wZW50ZWxlbWV0cnkvY29yZSc7XG5cbmV4cG9ydCBjb25zdCBBV1NYUkFZX1RSQUNFX0lEX0hFQURFUiA9ICdYLUFtem4tVHJhY2UtSWQnO1xuXG5jb25zdCBUUkFDRV9IRUFERVJfREVMSU1JVEVSID0gJzsnO1xuY29uc3QgS1ZfREVMSU1JVEVSID0gJz0nO1xuXG5jb25zdCBUUkFDRV9JRF9LRVkgPSAnUm9vdCc7XG5jb25zdCBUUkFDRV9JRF9MRU5HVEggPSAzNTtcbmNvbnN0IFRSQUNFX0lEX1ZFUlNJT04gPSAnMSc7XG5jb25zdCBUUkFDRV9JRF9ERUxJTUlURVIgPSAnLSc7XG5jb25zdCBUUkFDRV9JRF9ERUxJTUlURVJfSU5ERVhfMSA9IDE7XG5jb25zdCBUUkFDRV9JRF9ERUxJTUlURVJfSU5ERVhfMiA9IDEwO1xuY29uc3QgVFJBQ0VfSURfRklSU1RfUEFSVF9MRU5HVEggPSA4O1xuXG5jb25zdCBQQVJFTlRfSURfS0VZID0gJ1BhcmVudCc7XG5cbmNvbnN0IFNBTVBMRURfRkxBR19LRVkgPSAnU2FtcGxlZCc7XG5jb25zdCBTQU1QTEVEX0ZMQUdfTEVOR1RIID0gMTtcbmNvbnN0IElTX1NBTVBMRUQgPSAnMSc7XG5jb25zdCBOT1RfU0FNUExFRCA9ICcwJztcblxuY29uc3QgVkFMSURfVFJBQ0VJRF9SRUdFWCA9IC9eKFswLTlhLWZdezMyfSkkL2k7XG5jb25zdCBWQUxJRF9TUEFOSURfUkVHRVggPSAvXlswLTlhLWZdezE2fSQvaTtcbi8qKlxuICogSW1wbGVtZW50YXRpb24gb2YgdGhlIEFXUyBYLVJheSBUcmFjZSBIZWFkZXIgcHJvcGFnYXRpb24gcHJvdG9jb2wuIFNlZSA8YSBocmVmPVxuICogaHR0cHM6Ly9odHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20veHJheS9sYXRlc3QvZGV2Z3VpZGUveHJheS1jb25jZXB0cy5odG1sI3hyYXktY29uY2VwdHMtdHJhY2luZ2hlYWRlcj5BV1NcbiAqIFRyYWNpbmcgaGVhZGVyIHNwZWM8L2E+XG4gKlxuICogQW4gZXhhbXBsZSBBV1MgWHJheSBUcmFjaW5nIEhlYWRlciBpcyBzaG93biBiZWxvdzpcbiAqIFgtQW16bi1UcmFjZS1JZDogUm9vdD0xLTU3NTllOTg4LWJkODYyZTNmZTFiZTQ2YTk5NDI3Mjc5MztQYXJlbnQ9NTM5OTVjM2Y0MmNkOGFkODtTYW1wbGVkPTFcbiAqL1xuZXhwb3J0IGNsYXNzIEFXU1hSYXlQcm9wYWdhdG9yIGltcGxlbWVudHMgSHR0cFRleHRQcm9wYWdhdG9yIHtcbiAgaW5qZWN0KGNvbnRleHQ6IENvbnRleHQsIGNhcnJpZXI6IHVua25vd24sIHNldHRlcjogU2V0dGVyRnVuY3Rpb24pIHtcbiAgICBjb25zdCBzcGFuQ29udGV4dCA9IGdldFBhcmVudFNwYW5Db250ZXh0KGNvbnRleHQpO1xuICAgIGlmICghc3BhbkNvbnRleHQgfHwgIWlzVmFsaWQoc3BhbkNvbnRleHQpKSByZXR1cm47XG5cbiAgICBjb25zdCBvdFRyYWNlSWQgPSBzcGFuQ29udGV4dC50cmFjZUlkO1xuICAgIGNvbnN0IHhyYXlUcmFjZUlkID1cbiAgICAgIFRSQUNFX0lEX1ZFUlNJT04gK1xuICAgICAgVFJBQ0VfSURfREVMSU1JVEVSICtcbiAgICAgIG90VHJhY2VJZC5zdWJzdHJpbmcoMCwgVFJBQ0VfSURfRklSU1RfUEFSVF9MRU5HVEgpICtcbiAgICAgIFRSQUNFX0lEX0RFTElNSVRFUiArXG4gICAgICBvdFRyYWNlSWQuc3Vic3RyaW5nKFRSQUNFX0lEX0ZJUlNUX1BBUlRfTEVOR1RIKTtcbiAgICBjb25zdCBwYXJlbnRJZCA9IHNwYW5Db250ZXh0LnNwYW5JZDtcbiAgICBjb25zdCBzYW1wbGluZ0ZsYWcgPSBzcGFuQ29udGV4dC50cmFjZUZsYWdzID8gSVNfU0FNUExFRCA6IE5PVF9TQU1QTEVEO1xuICAgIC8vIFRPRE86IEFkZCBPVCB0cmFjZSBzdGF0ZSB0byB0aGUgWC1SYXkgdHJhY2UgaGVhZGVyXG5cbiAgICBjb25zdCB0cmFjZUhlYWRlciA9XG4gICAgICBUUkFDRV9JRF9LRVkgK1xuICAgICAgS1ZfREVMSU1JVEVSICtcbiAgICAgIHhyYXlUcmFjZUlkICtcbiAgICAgIFRSQUNFX0hFQURFUl9ERUxJTUlURVIgK1xuICAgICAgUEFSRU5UX0lEX0tFWSArXG4gICAgICBLVl9ERUxJTUlURVIgK1xuICAgICAgcGFyZW50SWQgK1xuICAgICAgVFJBQ0VfSEVBREVSX0RFTElNSVRFUiArXG4gICAgICBTQU1QTEVEX0ZMQUdfS0VZICtcbiAgICAgIEtWX0RFTElNSVRFUiArXG4gICAgICBzYW1wbGluZ0ZsYWc7XG5cbiAgICBzZXR0ZXIoY2FycmllciwgQVdTWFJBWV9UUkFDRV9JRF9IRUFERVIsIHRyYWNlSGVhZGVyKTtcbiAgfVxuXG4gIGV4dHJhY3QoY29udGV4dDogQ29udGV4dCwgY2FycmllcjogdW5rbm93biwgZ2V0dGVyOiBHZXR0ZXJGdW5jdGlvbik6IENvbnRleHQge1xuICAgIGNvbnN0IHNwYW5Db250ZXh0ID0gdGhpcy5nZXRTcGFuQ29udGV4dEZyb21IZWFkZXIoY2FycmllciwgZ2V0dGVyKTtcbiAgICBpZiAoIWlzVmFsaWQoc3BhbkNvbnRleHQpKSByZXR1cm4gY29udGV4dDtcblxuICAgIHJldHVybiBzZXRFeHRyYWN0ZWRTcGFuQ29udGV4dChjb250ZXh0LCBzcGFuQ29udGV4dCk7XG4gIH1cblxuICBwcml2YXRlIGdldFNwYW5Db250ZXh0RnJvbUhlYWRlcihcbiAgICBjYXJyaWVyOiB1bmtub3duLFxuICAgIGdldHRlcjogR2V0dGVyRnVuY3Rpb25cbiAgKTogU3BhbkNvbnRleHQge1xuICAgIGNvbnN0IHRyYWNlSGVhZGVyID0gZ2V0dGVyKGNhcnJpZXIsIEFXU1hSQVlfVFJBQ0VfSURfSEVBREVSKTtcbiAgICAvLyBPbmx5IGlmIHRoZSByZXR1cm5lZCB0cmFjZUhlYWRlciBpcyBubyBlbXB0eSBzdHJpbmcgY2FuIGJlIGV4dHJhY3RlZFxuICAgIGlmICghdHJhY2VIZWFkZXIgfHwgdHlwZW9mIHRyYWNlSGVhZGVyICE9PSAnc3RyaW5nJylcbiAgICAgIHJldHVybiBJTlZBTElEX1NQQU5fQ09OVEVYVDtcblxuICAgIGxldCBwb3MgPSAwO1xuICAgIGxldCB0cmltbWVkUGFydDogc3RyaW5nO1xuICAgIGxldCBwYXJzZWRUcmFjZUlkID0gSU5WQUxJRF9UUkFDRV9JRDtcbiAgICBsZXQgcGFyc2VkU3BhbklkID0gSU5WQUxJRF9TUEFOX0lEO1xuICAgIGxldCBwYXJzZWRUcmFjZUZsYWdzID0gbnVsbDtcbiAgICB3aGlsZSAocG9zIDwgdHJhY2VIZWFkZXIubGVuZ3RoKSB7XG4gICAgICBjb25zdCBkZWxpbWl0ZXJJbmRleCA9IHRyYWNlSGVhZGVyLmluZGV4T2YoVFJBQ0VfSEVBREVSX0RFTElNSVRFUiwgcG9zKTtcbiAgICAgIGlmIChkZWxpbWl0ZXJJbmRleCA+PSAwKSB7XG4gICAgICAgIHRyaW1tZWRQYXJ0ID0gdHJhY2VIZWFkZXIuc3Vic3RyaW5nKHBvcywgZGVsaW1pdGVySW5kZXgpLnRyaW0oKTtcbiAgICAgICAgcG9zID0gZGVsaW1pdGVySW5kZXggKyAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy9sYXN0IHBhcnRcbiAgICAgICAgdHJpbW1lZFBhcnQgPSB0cmFjZUhlYWRlci5zdWJzdHJpbmcocG9zKS50cmltKCk7XG4gICAgICAgIHBvcyA9IHRyYWNlSGVhZGVyLmxlbmd0aDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGVxdWFsc0luZGV4ID0gdHJpbW1lZFBhcnQuaW5kZXhPZihLVl9ERUxJTUlURVIpO1xuXG4gICAgICBjb25zdCB2YWx1ZSA9IHRyaW1tZWRQYXJ0LnN1YnN0cmluZyhlcXVhbHNJbmRleCArIDEpO1xuXG4gICAgICBpZiAodHJpbW1lZFBhcnQuc3RhcnRzV2l0aChUUkFDRV9JRF9LRVkpKSB7XG4gICAgICAgIHBhcnNlZFRyYWNlSWQgPSB0aGlzLl9wYXJzZVRyYWNlSWQodmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKHRyaW1tZWRQYXJ0LnN0YXJ0c1dpdGgoUEFSRU5UX0lEX0tFWSkpIHtcbiAgICAgICAgcGFyc2VkU3BhbklkID0gdGhpcy5fcGFyc2VTcGFuSWQodmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKHRyaW1tZWRQYXJ0LnN0YXJ0c1dpdGgoU0FNUExFRF9GTEFHX0tFWSkpIHtcbiAgICAgICAgcGFyc2VkVHJhY2VGbGFncyA9IHRoaXMuX3BhcnNlVHJhY2VGbGFnKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHBhcnNlZFRyYWNlRmxhZ3MgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBJTlZBTElEX1NQQU5fQ09OVEVYVDtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0U3BhbkNvbnRleHQ6IFNwYW5Db250ZXh0ID0ge1xuICAgICAgdHJhY2VJZDogcGFyc2VkVHJhY2VJZCxcbiAgICAgIHNwYW5JZDogcGFyc2VkU3BhbklkLFxuICAgICAgdHJhY2VGbGFnczogcGFyc2VkVHJhY2VGbGFncyxcbiAgICAgIGlzUmVtb3RlOiB0cnVlLFxuICAgIH07XG4gICAgaWYgKCFpc1ZhbGlkKHJlc3VsdFNwYW5Db250ZXh0KSkge1xuICAgICAgcmV0dXJuIElOVkFMSURfU1BBTl9DT05URVhUO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0U3BhbkNvbnRleHQ7XG4gIH1cblxuICBwcml2YXRlIF9wYXJzZVRyYWNlSWQoeHJheVRyYWNlSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gQ2hlY2sgbGVuZ3RoIG9mIHRyYWNlIGlkXG4gICAgaWYgKHhyYXlUcmFjZUlkLmxlbmd0aCAhPT0gVFJBQ0VfSURfTEVOR1RIKSB7XG4gICAgICByZXR1cm4gSU5WQUxJRF9UUkFDRV9JRDtcbiAgICB9XG5cbiAgICAvLyBDaGVjayB2ZXJzaW9uIHRyYWNlIGlkIHZlcnNpb25cbiAgICBpZiAoIXhyYXlUcmFjZUlkLnN0YXJ0c1dpdGgoVFJBQ0VfSURfVkVSU0lPTikpIHtcbiAgICAgIHJldHVybiBJTlZBTElEX1RSQUNFX0lEO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGRlbGltaXRlcnNcbiAgICBpZiAoXG4gICAgICB4cmF5VHJhY2VJZC5jaGFyQXQoVFJBQ0VfSURfREVMSU1JVEVSX0lOREVYXzEpICE9PSBUUkFDRV9JRF9ERUxJTUlURVIgfHxcbiAgICAgIHhyYXlUcmFjZUlkLmNoYXJBdChUUkFDRV9JRF9ERUxJTUlURVJfSU5ERVhfMikgIT09IFRSQUNFX0lEX0RFTElNSVRFUlxuICAgICkge1xuICAgICAgcmV0dXJuIElOVkFMSURfVFJBQ0VfSUQ7XG4gICAgfVxuXG4gICAgY29uc3QgZXBvY2hQYXJ0ID0geHJheVRyYWNlSWQuc3Vic3RyaW5nKFxuICAgICAgVFJBQ0VfSURfREVMSU1JVEVSX0lOREVYXzEgKyAxLFxuICAgICAgVFJBQ0VfSURfREVMSU1JVEVSX0lOREVYXzJcbiAgICApO1xuICAgIGNvbnN0IHVuaXF1ZVBhcnQgPSB4cmF5VHJhY2VJZC5zdWJzdHJpbmcoXG4gICAgICBUUkFDRV9JRF9ERUxJTUlURVJfSU5ERVhfMiArIDEsXG4gICAgICBUUkFDRV9JRF9MRU5HVEhcbiAgICApO1xuICAgIGNvbnN0IHJlc1RyYWNlSWQgPSBlcG9jaFBhcnQgKyB1bmlxdWVQYXJ0O1xuXG4gICAgLy8gQ2hlY2sgdGhlIGNvbnRlbnQgb2YgdHJhY2UgaWRcbiAgICBpZiAoIVZBTElEX1RSQUNFSURfUkVHRVgudGVzdChyZXNUcmFjZUlkKSkge1xuICAgICAgcmV0dXJuIElOVkFMSURfVFJBQ0VfSUQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc1RyYWNlSWQ7XG4gIH1cblxuICBwcml2YXRlIF9wYXJzZVNwYW5JZCh4cmF5UGFyZW50SWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFZBTElEX1NQQU5JRF9SRUdFWC50ZXN0KHhyYXlQYXJlbnRJZClcbiAgICAgID8geHJheVBhcmVudElkXG4gICAgICA6IElOVkFMSURfU1BBTl9JRDtcbiAgfVxuXG4gIHByaXZhdGUgX3BhcnNlVHJhY2VGbGFnKHhyYXlTYW1wbGVkRmxhZzogc3RyaW5nKTogVHJhY2VGbGFncyB8IG51bGwge1xuICAgIGlmIChcbiAgICAgIHhyYXlTYW1wbGVkRmxhZy5sZW5ndGggPT09IFNBTVBMRURfRkxBR19MRU5HVEggJiZcbiAgICAgIHhyYXlTYW1wbGVkRmxhZyA9PT0gTk9UX1NBTVBMRURcbiAgICApIHtcbiAgICAgIHJldHVybiBUcmFjZUZsYWdzLk5PTkU7XG4gICAgfVxuICAgIGlmICh4cmF5U2FtcGxlZEZsYWcgPT09IElTX1NBTVBMRUQpIHtcbiAgICAgIHJldHVybiBUcmFjZUZsYWdzLlNBTVBMRUQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXX0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy96b2NvbmcvRG9jdW1lbnRzL2ZvcmtlZC9hd3Mtb3BlbnRlbGVtZXRyeS1qcy9wYWNrYWdlcy9vcGVudGVsZW1ldHJ5LXByb3BhZ2F0b3ItYXdzLXhyYXkvc3JjL0FXU1hSYXlQcm9wYWdhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJhQUFBOzs7Ozs7Ozs7Ozs7OztrcnJCQWNHO3FRQUVILEtBQUEsQ0FBQSxLQUFBLDBCQUFBLE9BQUEsQ0FBQSxvQkFBQSxDQUFBLENBQUEsQ0FVQSxLQUFBLENBQUEsTUFBQSwwQkFBQSxPQUFBLENBQUEscUJBQUEsQ0FBQSxDQUFBLEMsd0JBT2EsT0FBQSxDQUFBLHVCQUFBLENBQTBCLGlCQUExQixDQUViLEtBQU0sQ0FBQSxzQkFBc0IsMEJBQUcsR0FBSCxDQUE1QixDQUNBLEtBQU0sQ0FBQSxZQUFZLDBCQUFHLEdBQUgsQ0FBbEIsQ0FFQSxLQUFNLENBQUEsWUFBWSwwQkFBRyxNQUFILENBQWxCLENBQ0EsS0FBTSxDQUFBLGVBQWUsMEJBQUcsRUFBSCxDQUFyQixDQUNBLEtBQU0sQ0FBQSxnQkFBZ0IsMEJBQUcsR0FBSCxDQUF0QixDQUNBLEtBQU0sQ0FBQSxrQkFBa0IsMkJBQUcsR0FBSCxDQUF4QixDQUNBLEtBQU0sQ0FBQSwwQkFBMEIsMkJBQUcsQ0FBSCxDQUFoQyxDQUNBLEtBQU0sQ0FBQSwwQkFBMEIsMkJBQUcsRUFBSCxDQUFoQyxDQUNBLEtBQU0sQ0FBQSwwQkFBMEIsMkJBQUcsQ0FBSCxDQUFoQyxDQUVBLEtBQU0sQ0FBQSxhQUFhLDJCQUFHLFFBQUgsQ0FBbkIsQ0FFQSxLQUFNLENBQUEsZ0JBQWdCLDJCQUFHLFNBQUgsQ0FBdEIsQ0FDQSxLQUFNLENBQUEsbUJBQW1CLDJCQUFHLENBQUgsQ0FBekIsQ0FDQSxLQUFNLENBQUEsVUFBVSwyQkFBRyxHQUFILENBQWhCLENBQ0EsS0FBTSxDQUFBLFdBQVcsMkJBQUcsR0FBSCxDQUFqQixDQUVBLEtBQU0sQ0FBQSxtQkFBbUIsMkJBQUcs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QUFBLGtCQUFrQixDQUFDLElBQW5CLENBQXdCLFlBQXhCLCtCQUNILFlBREcsK0JBRUgsS0FBQSxDQUFBLGVBRkcsQ0FBUCxDQUdELENBRU8sZUFBZSxDQUFDLGVBQUQsQ0FBd0Isa0RBQzdDLEdBQ0UsNkJBQUEsZUFBZSxDQUFDLE1BQWhCLEdBQTJCLG1CQUEzQixnQ0FDQSxlQUFlLEdBQUssV0FEcEIsQ0FERixDQUdFLHNEQUNBLE1BQU8sQ0FBQSxLQUFBLENBQUEsVUFBQSxDQUFXLElBQWxCLENBQ0QsQ0FMRCxrQ0FENkMseUJBTzdDLEdBQUksZUFBZSxHQUFLLFVBQXhCLENBQW9DLHNEQUNsQyxNQUFPLENBQUEsS0FBQSxDQUFBLFVBQUEsQ0FBVyxPQUFsQixDQUNELENBRkQsa0NBUDZDLHlCQVU3QyxNQUFPLEtBQVAsQ0FDRCxDQWxKMkIsQyx5QkFBOUIsT0FBQSxDQUFBLGlCQUFBLENBQUEsaUJBQUEsQyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgVGhlIE9wZW5UZWxlbWV0cnkgQXV0aG9yc1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgIGh0dHBzOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7XG4gIENvbnRleHQsXG4gIEh0dHBUZXh0UHJvcGFnYXRvcixcbiAgU3BhbkNvbnRleHQsXG4gIFRyYWNlRmxhZ3MsXG4gIFNldHRlckZ1bmN0aW9uLFxuICBHZXR0ZXJGdW5jdGlvbixcbiAgSU5WQUxJRF9UUkFDRV9JRCxcbiAgSU5WQUxJRF9TUEFOX0lELFxufSBmcm9tICdAb3BlbnRlbGVtZXRyeS9hcGknO1xuaW1wb3J0IHtcbiAgZ2V0UGFyZW50U3BhbkNvbnRleHQsXG4gIHNldEV4dHJhY3RlZFNwYW5Db250ZXh0LFxuICBJTlZBTElEX1NQQU5fQ09OVEVYVCxcbiAgaXNWYWxpZCxcbn0gZnJvbSAnQG9wZW50ZWxlbWV0cnkvY29yZSc7XG5cbmV4cG9ydCBjb25zdCBBV1NYUkFZX1RSQUNFX0lEX0hFQURFUiA9ICdYLUFtem4tVHJhY2UtSWQnO1xuXG5jb25zdCBUUkFDRV9IRUFERVJfREVMSU1JVEVSID0gJzsnO1xuY29uc3QgS1ZfREVMSU1JVEVSID0gJz0nO1xuXG5jb25zdCBUUkFDRV9JRF9LRVkgPSAnUm9vdCc7XG5jb25zdCBUUkFDRV9JRF9MRU5HVEggPSAzNTtcbmNvbnN0IFRSQUNFX0lEX1ZFUlNJT04gPSAnMSc7XG5jb25zdCBUUkFDRV9JRF9ERUxJTUlURVIgPSAnLSc7XG5jb25zdCBUUkFDRV9JRF9ERUxJTUlURVJfSU5ERVhfMSA9IDE7XG5jb25zdCBUUkFDRV9JRF9ERUxJTUlURVJfSU5ERVhfMiA9IDEwO1xuY29uc3QgVFJBQ0VfSURfRklSU1RfUEFSVF9MRU5HVEggPSA4O1xuXG5jb25zdCBQQVJFTlRfSURfS0VZID0gJ1BhcmVudCc7XG5cbmNvbnN0IFNBTVBMRURfRkxBR19LRVkgPSAnU2FtcGxlZCc7XG5jb25zdCBTQU1QTEVEX0ZMQUdfTEVOR1RIID0gMTtcbmNvbnN0IElTX1NBTVBMRUQgPSAnMSc7XG5jb25zdCBOT1RfU0FNUExFRCA9ICcwJztcblxuY29uc3QgVkFMSURfVFJBQ0VJRF9SRUdFWCA9IC9eKFswLTlhLWZdezMyfSkkL2k7XG5jb25zdCBWQUxJRF9TUEFOSURfUkVHRVggPSAvXlswLTlhLWZdezE2fSQvaTtcbi8qKlxuICogSW1wbGVtZW50YXRpb24gb2YgdGhlIEFXUyBYLVJheSBUcmFjZSBIZWFkZXIgcHJvcGFnYXRpb24gcHJvdG9jb2wuIFNlZSA8YSBocmVmPVxuICogaHR0cHM6Ly9odHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20veHJheS9sYXRlc3QvZGV2Z3VpZGUveHJheS1jb25jZXB0cy5odG1sI3hyYXktY29uY2VwdHMtdHJhY2luZ2hlYWRlcj5BV1NcbiAqIFRyYWNpbmcgaGVhZGVyIHNwZWM8L2E+XG4gKlxuICogQW4gZXhhbXBsZSBBV1MgWHJheSBUcmFjaW5nIEhlYWRlciBpcyBzaG93biBiZWxvdzpcbiAqIFgtQW16bi1UcmFjZS1JZDogUm9vdD0xLTU3NTllOTg4LWJkODYyZTNmZTFiZTQ2YTk5NDI3Mjc5MztQYXJlbnQ9NTM5OTVjM2Y0MmNkOGFkODtTYW1wbGVkPTFcbiAqL1xuZXhwb3J0IGNsYXNzIEFXU1hSYXlQcm9wYWdhdG9yIGltcGxlbWVudHMgSHR0cFRleHRQcm9wYWdhdG9yIHtcbiAgaW5qZWN0KGNvbnRleHQ6IENvbnRleHQsIGNhcnJpZXI6IHVua25vd24sIHNldHRlcjogU2V0dGVyRnVuY3Rpb24pIHtcbiAgICBjb25zdCBzcGFuQ29udGV4dCA9IGdldFBhcmVudFNwYW5Db250ZXh0KGNvbnRleHQpO1xuICAgIGlmICghc3BhbkNvbnRleHQgfHwgIWlzVmFsaWQoc3BhbkNvbnRleHQpKSByZXR1cm47XG5cbiAgICBjb25zdCBvdFRyYWNlSWQgPSBzcGFuQ29udGV4dC50cmFjZUlkO1xuICAgIGNvbnN0IHhyYXlUcmFjZUlkID1cbiAgICAgIFRSQUNFX0lEX1ZFUlNJT04gK1xuICAgICAgVFJBQ0VfSURfREVMSU1JVEVSICtcbiAgICAgIG90VHJhY2VJZC5zdWJzdHJpbmcoMCwgVFJBQ0VfSURfRklSU1RfUEFSVF9MRU5HVEgpICtcbiAgICAgIFRSQUNFX0lEX0RFTElNSVRFUiArXG4gICAgICBvdFRyYWNlSWQuc3Vic3RyaW5nKFRSQUNFX0lEX0ZJUlNUX1BBUlRfTEVOR1RIKTtcbiAgICBjb25zdCBwYXJlbnRJZCA9IHNwYW5Db250ZXh0LnNwYW5JZDtcbiAgICBjb25zdCBzYW1wbGluZ0ZsYWcgPSBzcGFuQ29udGV4dC50cmFjZUZsYWdzID8gSVNfU0FNUExFRCA6IE5PVF9TQU1QTEVEO1xuICAgIC8vIFRPRE86IEFkZCBPVCB0cmFjZSBzdGF0ZSB0byB0aGUgWC1SYXkgdHJhY2UgaGVhZGVyXG5cbiAgICBjb25zdCB0cmFjZUhlYWRlciA9XG4gICAgICBUUkFDRV9JRF9LRVkgK1xuICAgICAgS1ZfREVMSU1JVEVSICtcbiAgICAgIHhyYXlUcmFjZUlkICtcbiAgICAgIFRSQUNFX0hFQURFUl9ERUxJTUlURVIgK1xuICAgICAgUEFSRU5UX0lEX0tFWSArXG4gICAgICBLVl9ERUxJTUlURVIgK1xuICAgICAgcGFyZW50SWQgK1xuICAgICAgVFJBQ0VfSEVBREVSX0RFTElNSVRFUiArXG4gICAgICBTQU1QTEVEX0ZMQUdfS0VZICtcbiAgICAgIEtWX0RFTElNSVRFUiArXG4gICAgICBzYW1wbGluZ0ZsYWc7XG5cbiAgICBzZXR0ZXIoY2FycmllciwgQVdTWFJBWV9UUkFDRV9JRF9IRUFERVIsIHRyYWNlSGVhZGVyKTtcbiAgfVxuXG4gIGV4dHJhY3QoY29udGV4dDogQ29udGV4dCwgY2FycmllcjogdW5rbm93biwgZ2V0dGVyOiBHZXR0ZXJGdW5jdGlvbik6IENvbnRleHQge1xuICAgIGNvbnN0IHNwYW5Db250ZXh0ID0gdGhpcy5nZXRTcGFuQ29udGV4dEZyb21IZWFkZXIoY2FycmllciwgZ2V0dGVyKTtcbiAgICBpZiAoIWlzVmFsaWQoc3BhbkNvbnRleHQpKSByZXR1cm4gY29udGV4dDtcblxuICAgIHJldHVybiBzZXRFeHRyYWN0ZWRTcGFuQ29udGV4dChjb250ZXh0LCBzcGFuQ29udGV4dCk7XG4gIH1cblxuICBwcml2YXRlIGdldFNwYW5Db250ZXh0RnJvbUhlYWRlcihcbiAgICBjYXJyaWVyOiB1bmtub3duLFxuICAgIGdldHRlcjogR2V0dGVyRnVuY3Rpb25cbiAgKTogU3BhbkNvbnRleHQge1xuICAgIGNvbnN0IHRyYWNlSGVhZGVyID0gZ2V0dGVyKGNhcnJpZXIsIEFXU1hSQVlfVFJBQ0VfSURfSEVBREVSKTtcbiAgICAvLyBPbmx5IGlmIHRoZSByZXR1cm5lZCB0cmFjZUhlYWRlciBpcyBubyBlbXB0eSBzdHJpbmcgY2FuIGJlIGV4dHJhY3RlZFxuICAgIGlmICghdHJhY2VIZWFkZXIgfHwgdHlwZW9mIHRyYWNlSGVhZGVyICE9PSAnc3RyaW5nJylcbiAgICAgIHJldHVybiBJTlZBTElEX1NQQU5fQ09OVEVYVDtcblxuICAgIGxldCBwb3MgPSAwO1xuICAgIGxldCB0cmltbWVkUGFydDogc3RyaW5nO1xuICAgIGxldCBwYXJzZWRUcmFjZUlkID0gSU5WQUxJRF9UUkFDRV9JRDtcbiAgICBsZXQgcGFyc2VkU3BhbklkID0gSU5WQUxJRF9TUEFOX0lEO1xuICAgIGxldCBwYXJzZWRUcmFjZUZsYWdzID0gbnVsbDtcbiAgICB3aGlsZSAocG9zIDwgdHJhY2VIZWFkZXIubGVuZ3RoKSB7XG4gICAgICBjb25zdCBkZWxpbWl0ZXJJbmRleCA9IHRyYWNlSGVhZGVyLmluZGV4T2YoVFJBQ0VfSEVBREVSX0RFTElNSVRFUiwgcG9zKTtcbiAgICAgIGlmIChkZWxpbWl0ZXJJbmRleCA+PSAwKSB7XG4gICAgICAgIHRyaW1tZWRQYXJ0ID0gdHJhY2VIZWFkZXIuc3Vic3RyaW5nKHBvcywgZGVsaW1pdGVySW5kZXgpLnRyaW0oKTtcbiAgICAgICAgcG9zID0gZGVsaW1pdGVySW5kZXggKyAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy9sYXN0IHBhcnRcbiAgICAgICAgdHJpbW1lZFBhcnQgPSB0cmFjZUhlYWRlci5zdWJzdHJpbmcocG9zKS50cmltKCk7XG4gICAgICAgIHBvcyA9IHRyYWNlSGVhZGVyLmxlbmd0aDtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGVxdWFsc0luZGV4ID0gdHJpbW1lZFBhcnQuaW5kZXhPZihLVl9ERUxJTUlURVIpO1xuXG4gICAgICBjb25zdCB2YWx1ZSA9IHRyaW1tZWRQYXJ0LnN1YnN0cmluZyhlcXVhbHNJbmRleCArIDEpO1xuXG4gICAgICBpZiAodHJpbW1lZFBhcnQuc3RhcnRzV2l0aChUUkFDRV9JRF9LRVkpKSB7XG4gICAgICAgIHBhcnNlZFRyYWNlSWQgPSB0aGlzLl9wYXJzZVRyYWNlSWQodmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKHRyaW1tZWRQYXJ0LnN0YXJ0c1dpdGgoUEFSRU5UX0lEX0tFWSkpIHtcbiAgICAgICAgcGFyc2VkU3BhbklkID0gdGhpcy5fcGFyc2VTcGFuSWQodmFsdWUpO1xuICAgICAgfVxuICAgICAgaWYgKHRyaW1tZWRQYXJ0LnN0YXJ0c1dpdGgoU0FNUExFRF9GTEFHX0tFWSkpIHtcbiAgICAgICAgcGFyc2VkVHJhY2VGbGFncyA9IHRoaXMuX3BhcnNlVHJhY2VGbGFnKHZhbHVlKTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKHBhcnNlZFRyYWNlRmxhZ3MgPT09IG51bGwpIHtcbiAgICAgIHJldHVybiBJTlZBTElEX1NQQU5fQ09OVEVYVDtcbiAgICB9XG4gICAgY29uc3QgcmVzdWx0U3BhbkNvbnRleHQ6IFNwYW5Db250ZXh0ID0ge1xuICAgICAgdHJhY2VJZDogcGFyc2VkVHJhY2VJZCxcbiAgICAgIHNwYW5JZDogcGFyc2VkU3BhbklkLFxuICAgICAgdHJhY2VGbGFnczogcGFyc2VkVHJhY2VGbGFncyxcbiAgICAgIGlzUmVtb3RlOiB0cnVlLFxuICAgIH07XG4gICAgaWYgKCFpc1ZhbGlkKHJlc3VsdFNwYW5Db250ZXh0KSkge1xuICAgICAgcmV0dXJuIElOVkFMSURfU1BBTl9DT05URVhUO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0U3BhbkNvbnRleHQ7XG4gIH1cblxuICBwcml2YXRlIF9wYXJzZVRyYWNlSWQoeHJheVRyYWNlSWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgLy8gQ2hlY2sgbGVuZ3RoIG9mIHRyYWNlIGlkXG4gICAgaWYgKHhyYXlUcmFjZUlkLmxlbmd0aCAhPT0gVFJBQ0VfSURfTEVOR1RIKSB7XG4gICAgICByZXR1cm4gSU5WQUxJRF9UUkFDRV9JRDtcbiAgICB9XG5cbiAgICAvLyBDaGVjayB2ZXJzaW9uIHRyYWNlIGlkIHZlcnNpb25cbiAgICBpZiAoIXhyYXlUcmFjZUlkLnN0YXJ0c1dpdGgoVFJBQ0VfSURfVkVSU0lPTikpIHtcbiAgICAgIHJldHVybiBJTlZBTElEX1RSQUNFX0lEO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGRlbGltaXRlcnNcbiAgICBpZiAoXG4gICAgICB4cmF5VHJhY2VJZC5jaGFyQXQoVFJBQ0VfSURfREVMSU1JVEVSX0lOREVYXzEpICE9PSBUUkFDRV9JRF9ERUxJTUlURVIgfHxcbiAgICAgIHhyYXlUcmFjZUlkLmNoYXJBdChUUkFDRV9JRF9ERUxJTUlURVJfSU5ERVhfMikgIT09IFRSQUNFX0lEX0RFTElNSVRFUlxuICAgICkge1xuICAgICAgcmV0dXJuIElOVkFMSURfVFJBQ0VfSUQ7XG4gICAgfVxuXG4gICAgY29uc3QgZXBvY2hQYXJ0ID0geHJheVRyYWNlSWQuc3Vic3RyaW5nKFxuICAgICAgVFJBQ0VfSURfREVMSU1JVEVSX0lOREVYXzEgKyAxLFxuICAgICAgVFJBQ0VfSURfREVMSU1JVEVSX0lOREVYXzJcbiAgICApO1xuICAgIGNvbnN0IHVuaXF1ZVBhcnQgPSB4cmF5VHJhY2VJZC5zdWJzdHJpbmcoXG4gICAgICBUUkFDRV9JRF9ERUxJTUlURVJfSU5ERVhfMiArIDEsXG4gICAgICBUUkFDRV9JRF9MRU5HVEhcbiAgICApO1xuICAgIGNvbnN0IHJlc1RyYWNlSWQgPSBlcG9jaFBhcnQgKyB1bmlxdWVQYXJ0O1xuXG4gICAgLy8gQ2hlY2sgdGhlIGNvbnRlbnQgb2YgdHJhY2UgaWRcbiAgICBpZiAoIVZBTElEX1RSQUNFSURfUkVHRVgudGVzdChyZXNUcmFjZUlkKSkge1xuICAgICAgcmV0dXJuIElOVkFMSURfVFJBQ0VfSUQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc1RyYWNlSWQ7XG4gIH1cblxuICBwcml2YXRlIF9wYXJzZVNwYW5JZCh4cmF5UGFyZW50SWQ6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFZBTElEX1NQQU5JRF9SRUdFWC50ZXN0KHhyYXlQYXJlbnRJZClcbiAgICAgID8geHJheVBhcmVudElkXG4gICAgICA6IElOVkFMSURfU1BBTl9JRDtcbiAgfVxuXG4gIHByaXZhdGUgX3BhcnNlVHJhY2VGbGFnKHhyYXlTYW1wbGVkRmxhZzogc3RyaW5nKTogVHJhY2VGbGFncyB8IG51bGwge1xuICAgIGlmIChcbiAgICAgIHhyYXlTYW1wbGVkRmxhZy5sZW5ndGggPT09IFNBTVBMRURfRkxBR19MRU5HVEggJiZcbiAgICAgIHhyYXlTYW1wbGVkRmxhZyA9PT0gTk9UX1NBTVBMRURcbiAgICApIHtcbiAgICAgIHJldHVybiBUcmFjZUZsYWdzLk5PTkU7XG4gICAgfVxuICAgIGlmICh4cmF5U2FtcGxlZEZsYWcgPT09IElTX1NBTVBMRUQpIHtcbiAgICAgIHJldHVybiBUcmFjZUZsYWdzLlNBTVBMRUQ7XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG59XG4iXX0=